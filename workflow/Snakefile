from snakemake.utils import min_version
from pathlib import Path

min_version('8.20.1')

##### setup report #####
if not config:
    configfile: Path(workflow.basedir).parent / "config/config.yaml"

localrules:
    all,

##### load rules #####
include: "rules/common.smk"
include: "rules/qc.smk"
include: "rules/trim_repair.smk"
include: "rules/minimap2_align.smk"
include: "rules/methylation/methylation.smk"
include: "rules/snv_calling/clair3.smk" # propably deprecated
if config['deepvariant']['run_as_steps']:
    include: "rules/snv_calling/deepvariant_steps.smk"
else:
    include: "rules/snv_calling/deepvariant.smk"
include: "rules/snv_calling/deepvariant_postprocess.smk"
#include: "rules/snv_calling/pepper_deepvariant_margin.smk"  # propably deprecated
include: "rules/snv_calling/haplotagging.smk"
include: "rules/sv_calling/sniffles.smk"
#include: "rules/snv_calling/deepsomatic.smk" # wish to be deprecated, run deepsomatic by chromosome and as steps will be idea.
include: "rules/snv_calling/deepsomatic_by_chr.smk"
include: "rules/snv_calling/clairS.smk"
include: "rules/sv_calling/nanomonsv.smk"
include: "rules/sv_calling/savana.smk"
include: "rules/sv_calling/severus.smk"

##### target rules #####
rule all:
    input:
        get_final_output(),